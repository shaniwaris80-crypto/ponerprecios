<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ARSLAN ¬∑ PONER PRECIOS</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --kiwi:#16a34a;
  --kiwi2:#15803d;
  --ink:#111827;
  --muted:#6b7280;
  --bg:#ffffff;
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,system-ui,Arial,sans-serif;
  background:var(--bg);
  color:var(--ink);
}
header{
  position:sticky;top:0;z-index:10;
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{font-size:18px;margin:0}
.container{padding:14px 14px 90px}

.card{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
}

.hint{font-size:12px;color:var(--muted)}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{
  border-bottom:1px solid var(--border);
  padding:8px;
  text-align:left;
  font-size:14px;
}
th{font-size:12px;color:var(--muted);text-transform:uppercase}

.price-input{
  width:100%;
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 10px;
  font-size:14px;
}

.btn{
  border:1px solid var(--kiwi);
  background:linear-gradient(135deg,var(--kiwi),var(--kiwi2));
  color:#fff;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
}
.btn.ghost{
  background:#fff;
  color:var(--kiwi);
}
.btn.muted{
  background:#fff;
  border-color:var(--border);
  color:var(--ink);
}

.actions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.cell{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
}
.cell .name{
  font-weight:700;
  font-size:13px;
}
.cell .price{
  font-size:20px;
  font-weight:900;
  color:var(--kiwi);
  margin-top:10px;
}
@media print{
  @page{size:A4;margin:10mm}
  body{margin:0}
}
</style>
</head>

<body>

<header>
  <h1>üí∂ ARSLAN ¬∑ PONER PRECIOS</h1>
  <button class="btn ghost" onclick="resetPrices()">Reset</button>
</header>

<div class="container">

  <div class="card">
    <div class="hint">
      Pega productos (uno por l√≠nea) o entra desde LISTAS.<br>
      ‚èé Enter = siguiente precio ¬∑ Solo se exportan productos con precio.
    </div>
    <textarea id="pasteBox" class="price-input" placeholder="Ej:\nTOMATE RAMA\nLECHUGA ICEBERG" style="margin-top:8px;height:90px"></textarea>
    <div class="actions" style="margin-top:8px">
      <button class="btn muted" onclick="addFromPaste()">A√±adir productos</button>
    </div>
  </div>

  <div class="card">
    <div class="actions">
      <button class="btn muted" onclick="exportTXT()">üìÑ TXT</button>
      <button class="btn muted" onclick="exportWA()">üì≤ WhatsApp</button>
      <button class="btn" onclick="exportPDF()">üßæ PDF</button>
    </div>

    <div id="tableWrap"></div>
  </div>

</div>

<script>
/* ===========================
  STATE
=========================== */
const LS_KEY = "ARSLAN_PRECIOS_V1";
let PRICES = {};   // { PRODUCTO: {price, updatedAt} }

/* ===========================
  HELPERS
=========================== */
function norm(s){
  return s.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").trim().toUpperCase();
}
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(PRICES));
}
function load(){
  try{
    PRICES = JSON.parse(localStorage.getItem(LS_KEY)) || {};
  }catch{ PRICES = {}; }
}
function fmt(p){
  return (Math.round(p*100)/100).toFixed(2).replace(".",",")+"‚Ç¨";
}

/* ===========================
  LOAD FROM URL (?p=...)
=========================== */
function loadFromURL(){
  const q = new URLSearchParams(location.search);
  if(!q.has("p")) return;
  try{
    const arr = JSON.parse(decodeURIComponent(q.get("p")));
    arr.forEach(n=>{
      const k = norm(n);
      if(!PRICES[k]) PRICES[k]={price:"",updatedAt:0};
    });
  }catch{}
}

/* ===========================
  UI
=========================== */
function render(){
  const keys = Object.keys(PRICES).sort();
  if(!keys.length){
    document.getElementById("tableWrap").innerHTML =
      `<div class="hint">No hay productos.</div>`;
    return;
  }

  let html = `<table>
    <thead><tr><th>Producto</th><th style="width:160px">Precio</th></tr></thead>
    <tbody>`;

  keys.forEach((k,i)=>{
    html+=`
      <tr>
        <td><b>${k}</b></td>
        <td>
          <input class="price-input"
            type="number"
            step="0.01"
            inputmode="decimal"
            data-key="${k}"
            value="${PRICES[k].price||""}"
          >
        </td>
      </tr>`;
  });

  html+=`</tbody></table>`;
  document.getElementById("tableWrap").innerHTML = html;

  const inputs=[...document.querySelectorAll("input[data-key]")];
  inputs.forEach((inp,i)=>{
    inp.addEventListener("keydown",e=>{
      if(e.key==="Enter"){
        e.preventDefault();
        inputs[i+1]?.focus();
      }
    });
    inp.addEventListener("change",()=>{
      const v=parseFloat(inp.value);
      if(!isNaN(v)){
        PRICES[inp.dataset.key].price=v;
        PRICES[inp.dataset.key].updatedAt=Date.now();
        save();
      }
    });
  });
}

/* ===========================
  ACTIONS
=========================== */
function addFromPaste(){
  const t=document.getElementById("pasteBox").value;
  t.split("\n").map(norm).filter(Boolean).forEach(k=>{
    if(!PRICES[k]) PRICES[k]={price:"",updatedAt:0};
  });
  save(); render();
}

function resetPrices(){
  if(!confirm("¬øBorrar todos los precios?")) return;
  PRICES={}; save(); render();
}

function pricedList(){
  return Object.entries(PRICES)
    .filter(([k,v])=>v.price!=="" && !isNaN(v.price))
    .map(([k,v])=>({name:k,price:v.price}));
}

function exportTXT(){
  const l=pricedList();
  if(!l.length) return alert("No hay precios");
  const txt=l.map(x=>`${x.name}\t${fmt(x.price)}`).join("\n");
  download("PRECIOS.txt",txt);
}
function exportWA(){
  const l=pricedList();
  if(!l.length) return alert("No hay precios");
  const txt=l.map(x=>`${x.name}  ${fmt(x.price)}`).join("\n");
  window.open("https://wa.me/?text="+encodeURIComponent(txt));
}
function exportPDF(){
  const l=pricedList();
  if(!l.length) return alert("No hay precios");
  const w=window.open("","_blank");
  w.document.write(`<div class="grid">${
    l.map(x=>`<div class="cell"><div class="name">${x.name}</div><div class="price">${fmt(x.price)}</div></div>`).join("")
  }</div>`);
  w.print();
}

function download(n,c){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([c]));
  a.download=n; a.click();
}

/* ===========================
  INIT
=========================== */
load();
loadFromURL();
render();
</script>

</body>
</html>
